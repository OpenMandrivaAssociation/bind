--- bind-9.9.0/contrib/dlz/config.dlz.in.64bit	2011-11-05 06:14:28.000000000 +0100
+++ bind-9.9.0/contrib/dlz/config.dlz.in	2012-03-01 02:21:08.365302386 +0100
@@ -17,6 +17,13 @@
 #
 dlzdir='${DLZ_DRIVER_DIR}'
 
+AC_MSG_CHECKING([for target libdir])
+AC_RUN_IFELSE([int main(void) {exit((sizeof(void *) == 8) ? 0 : 1);}],
+	[target_lib=lib64],
+	[target_lib=lib],
+)
+AC_MSG_RESULT(["$target_lib"])
+
 #
 # Private autoconf macro to simplify configuring drivers:
 #
@@ -83,7 +90,7 @@ then
 		if test -f $d/include/libpq-fe.h
 		then
 			use_dlz_postgres=$d/include
-			use_dlz_postgres_lib=$d/lib
+			use_dlz_postgres_lib=$d/${target_lib}
 			break
 		fi
 	done
@@ -135,22 +142,22 @@ then
 		then
 			use_dlz_mysql=$d
 			mysql_include=$d/include/mysql
-			if test -d $d/lib/mysql
+			if test -d $d/${target_lib}/mysql
 			then
-				mysql_lib=$d/lib/mysql
+				mysql_lib=$d/${target_lib}/mysql
 			else
-				mysql_lib=$d/lib
+				mysql_lib=$d/${target_lib}
 			fi
 			break
 		elif test -f $d/include/mysql.h
 		then
 			use_dlz_mysql=$d
 			mysql_include=$d/include
-			if test -d $d/lib/mysql
+			if test -d $d/${target_lib}/mysql
 			then
-				mysql_lib=$d/lib/mysql
+				mysql_lib=$d/${target_lib}/mysql
 			else
-				mysql_lib=$d/lib
+				mysql_lib=$d/${target_lib}
 			fi
 			break
 		fi
@@ -161,20 +168,20 @@ then
 	if test -f $d/include/mysql/mysql.h
 	then
 		mysql_include=$d/include/mysql
-		if test -d $d/lib/mysql
+		if test -d $d/${target_lib}/mysql
 		then
-			mysql_lib=$d/lib/mysql
+			mysql_lib=$d/${target_lib}/mysql
 		else
-			mysql_lib=$d/lib
+			mysql_lib=$d/${target_lib}
 		fi
 	elif test -f $d/include/mysql.h
 	then
 		mysql_include=$d/include
-		if test -d $d/lib/mysql
+		if test -d $d/${target_lib}/mysql
 		then
-			mysql_lib=$d/lib/mysql
+			mysql_lib=$d/${target_lib}/mysql
 		else
-			mysql_lib=$d/lib
+			mysql_lib=$d/${target_lib}
 		fi
 	fi
 fi
@@ -383,10 +390,10 @@ case "$use_dlz_ldap" in
 	*)
 		DLZ_ADD_DRIVER(LDAP, dlz_ldap_driver,
 				[-I$use_dlz_ldap/include],
-				[-L$use_dlz_ldap/lib -lldap -llber])
+				[-L$use_dlz_ldap/${target_lib} -lldap -llber])
 
 		AC_MSG_RESULT(
-[using LDAP from $use_dlz_ldap/lib and $use_dlz_ldap/include])
+[using LDAP from $use_dlz_ldap/${target_lib} and $use_dlz_ldap/include])
 		;;
 esac
 
@@ -425,11 +432,11 @@ then
 		odbcdirs="/usr /usr/local /usr/pkg"
 		for d in $odbcdirs
 		do
-			if test -f $d/include/sql.h -a -f $d/lib/libodbc.a
+			if test -f $d/include/sql.h -a -f $d/${target_lib}/libodbc.a
 			then
 				use_dlz_odbc=$d
 				dlz_odbc_include="-I$use_dlz_odbc/include"
-				dlz_odbc_libs="-L$use_dlz_odbc/lib -lodbc"
+				dlz_odbc_libs="-L$use_dlz_odbc/${target_lib} -lodbc"
 				break
 			fi
 		done
